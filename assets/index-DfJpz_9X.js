import{h as we,d as ae,L as X,n as q,c as ie,a2 as xe,a3 as le,b as h,a4 as re,V as O,w as oe,a5 as Ce,a6 as ke,a7 as Be,a8 as Pe,a9 as Te,aa as Me,E as Ae,v as K,ab as Le,f as k,e as Z,x as Re,y as Fe,T as z,ac as Ne,S as B,R as $e,ad as ze,I as H,_ as W,K as Oe,u as We,ae as p,G as qe,P as ee,U as De,af as je,ag as Ke,ah as He,q as Ue,o as Ye,l as Ge,ai as Je}from"./index-c8Fo5no0.js";import{C as Qe,c as Xe}from"./index-j4eQ2Eld.js";import{B as Ze}from"./index-a-cluaxF.js";let pe=0;function et(){const e=we(),{name:n="unknown"}=(e==null?void 0:e.type)||{};return"".concat(n,"-").concat(++pe)}const[tt,nt]=ie("form"),at={colon:Boolean,disabled:Boolean,readonly:Boolean,required:[Boolean,String],showError:Boolean,labelWidth:q,labelAlign:String,inputAlign:String,scrollToError:Boolean,scrollToErrorPosition:String,validateFirst:Boolean,submitOnEnter:X,showErrorMessage:X,errorMessageAlign:String,validateTrigger:{type:[String,Array],default:"onBlur"}};var it=ae({name:tt,props:at,emits:["submit","failed"],setup(e,{emit:n,slots:o}){const{children:c,linkChildren:r}=xe(re),d=a=>a?c.filter(s=>a.includes(s.name)):c,L=a=>new Promise((s,f)=>{const y=[];d(a).reduce((j,M)=>j.then(()=>{if(!y.length)return M.validate().then(A=>{A&&y.push(A)})}),Promise.resolve()).then(()=>{y.length?f(y):s()})}),P=a=>new Promise((s,f)=>{const y=d(a);Promise.all(y.map(b=>b.validate())).then(b=>{b=b.filter(Boolean),b.length?f(b):s()})}),v=a=>{const s=c.find(f=>f.name===a);return s?new Promise((f,y)=>{s.validate().then(b=>{b?y(b):f()})}):Promise.reject()},E=a=>typeof a=="string"?v(a):e.validateFirst?L(a):P(a),g=a=>{typeof a=="string"&&(a=[a]),d(a).forEach(f=>{f.resetValidation()})},D=()=>c.reduce((a,s)=>(a[s.name]=s.getValidationStatus(),a),{}),T=(a,s)=>{c.some(f=>f.name===a?(f.$el.scrollIntoView(s),!0):!1)},R=()=>c.reduce((a,s)=>(s.name!==void 0&&(a[s.name]=s.formValue.value),a),{}),F=()=>{const a=R();E().then(()=>n("submit",a)).catch(s=>{n("failed",{values:a,errors:s});const{scrollToError:f,scrollToErrorPosition:y}=e;f&&s[0].name&&T(s[0].name,y?{block:y}:void 0)})},C=a=>{O(a),F()};return r({props:e}),le({submit:F,validate:E,getValues:R,scrollToField:T,resetValidation:g,getValidationStatus:D}),()=>{var a;return h("form",{class:nt(),onSubmit:C},[(a=o.default)==null?void 0:a.call(o)])}}});const St=oe(it);function se(e){return Array.isArray(e)?!e.length:e===0?!1:!e}function lt(e,n){if(se(e)){if(n.required)return!1;if(n.validateEmpty===!1)return!0}return!(n.pattern&&!n.pattern.test(String(e)))}function rt(e,n){return new Promise(o=>{const c=n.validator(e,n);if(Te(c)){c.then(o);return}o(c)})}function te(e,n){const{message:o}=n;return Pe(o)?o(e,n):o||""}function ot({target:e}){e.composing=!0}function ne({target:e}){e.composing&&(e.composing=!1,e.dispatchEvent(new Event("input")))}function st(e,n){const o=Ce();e.style.height="auto";let c=e.scrollHeight;if(ke(n)){const{maxHeight:r,minHeight:d}=n;r!==void 0&&(c=Math.min(c,r)),d!==void 0&&(c=Math.max(c,d))}c&&(e.style.height="".concat(c,"px"),Be(o))}function ct(e,n){return e==="number"&&(e="text",n!=null||(n="decimal")),e==="digit"&&(e="tel",n!=null||(n="numeric")),{type:e,inputmode:n}}function _(e){return[...e].length}function U(e,n){return[...e].slice(0,n).join("")}const[ut,S]=ie("field"),dt={id:String,name:String,leftIcon:String,rightIcon:String,autofocus:Boolean,clearable:Boolean,maxlength:q,max:Number,min:Number,formatter:Function,clearIcon:W("clear"),modelValue:Oe(""),inputAlign:String,placeholder:String,autocomplete:String,autocapitalize:String,autocorrect:String,errorMessage:String,enterkeyhint:String,clearTrigger:W("focus"),formatTrigger:W("onChange"),spellcheck:{type:Boolean,default:null},error:{type:Boolean,default:null},disabled:{type:Boolean,default:null},readonly:{type:Boolean,default:null},inputmode:String},ft=Me({},Xe,dt,{rows:q,type:W("text"),rules:Array,autosize:[Boolean,Object],labelWidth:q,labelClass:We,labelAlign:String,showWordLimit:Boolean,errorMessageAlign:String,colon:{type:Boolean,default:null}});var gt=ae({name:ut,props:ft,emits:["blur","focus","clear","keypress","clickInput","endValidate","startValidate","clickLeftIcon","clickRightIcon","update:modelValue"],setup(e,{emit:n,slots:o}){const c=et(),r=Ae({status:"unvalidated",focused:!1,validateMessage:""}),d=K(),L=K(),P=K(),{parent:v}=Le(re),E=()=>{var t;return String((t=e.modelValue)!=null?t:"")},g=t=>{if(B(e[t]))return e[t];if(v&&B(v.props[t]))return v.props[t]},D=k(()=>{const t=g("readonly");if(e.clearable&&!t){const i=E()!=="",l=e.clearTrigger==="always"||e.clearTrigger==="focus"&&r.focused;return i&&l}return!1}),T=k(()=>P.value&&o.input?P.value():e.modelValue),R=k(()=>{var t;const i=g("required");return i==="auto"?(t=e.rules)==null?void 0:t.some(l=>l.required):i}),F=t=>t.reduce((i,l)=>i.then(()=>{if(r.status==="failed")return;let{value:u}=T;if(l.formatter&&(u=l.formatter(u,l)),!lt(u,l)){r.status="failed",r.validateMessage=te(u,l);return}if(l.validator)return se(u)&&l.validateEmpty===!1?void 0:rt(u,l).then(m=>{m&&typeof m=="string"?(r.status="failed",r.validateMessage=m):m===!1&&(r.status="failed",r.validateMessage=te(u,l))})}),Promise.resolve()),C=()=>{r.status="unvalidated",r.validateMessage=""},a=()=>n("endValidate",{status:r.status,message:r.validateMessage}),s=(t=e.rules)=>new Promise(i=>{C(),t?(n("startValidate"),F(t).then(()=>{r.status==="failed"?(i({name:e.name,message:r.validateMessage}),a()):(r.status="passed",i(),a())})):i()}),f=t=>{if(v&&e.rules){const{validateTrigger:i}=v.props,l=p(i).includes(t),u=e.rules.filter(m=>m.trigger?p(m.trigger).includes(t):l);u.length&&s(u)}},y=t=>{var i;const{maxlength:l}=e;if(B(l)&&_(t)>+l){const u=E();if(u&&_(u)===+l)return u;const m=(i=d.value)==null?void 0:i.selectionEnd;if(r.focused&&m){const w=[...t],x=w.length-+l;return w.splice(m-x,x),w.join("")}return U(t,+l)}return t},b=(t,i="onChange")=>{var l,u;const m=t;t=y(t);const w=_(m)-_(t);if(e.type==="number"||e.type==="digit"){const V=e.type==="number";if(t=$e(t,V,V),i==="onBlur"&&t!==""&&(e.min!==void 0||e.max!==void 0)){const I=ze(+t,(l=e.min)!=null?l:-1/0,(u=e.max)!=null?u:1/0);+t!==I&&(t=I.toString())}}let x=0;if(e.formatter&&i===e.formatTrigger){const{formatter:V,maxlength:I}=e;if(t=V(t),B(I)&&_(t)>+I&&(t=U(t,+I)),d.value&&r.focused){const{selectionEnd:$}=d.value,Q=U(m,$);x=_(V(Q))-_(Q)}}if(d.value&&d.value.value!==t)if(r.focused){let{selectionStart:V,selectionEnd:I}=d.value;if(d.value.value=t,B(V)&&B(I)){const $=_(t);w?(V-=w,I-=w):x&&(V+=x,I+=x),d.value.setSelectionRange(Math.min(V,$),Math.min(I,$))}}else d.value.value=t;t!==e.modelValue&&n("update:modelValue",t)},j=t=>{t.target.composing||b(t.target.value)},M=()=>{var t;return(t=d.value)==null?void 0:t.blur()},A=()=>{var t;return(t=d.value)==null?void 0:t.focus()},N=()=>{const t=d.value;e.type==="textarea"&&e.autosize&&t&&st(t,e.autosize)},ce=t=>{r.focused=!0,n("focus",t),z(N),g("readonly")&&M()},ue=t=>{r.focused=!1,b(E(),"onBlur"),n("blur",t),!g("readonly")&&(f("onBlur"),z(N),De())},Y=t=>n("clickInput",t),de=t=>n("clickLeftIcon",t),fe=t=>n("clickRightIcon",t),ge=t=>{O(t),n("update:modelValue",""),n("clear",t)},G=k(()=>{if(typeof e.error=="boolean")return e.error;if(v&&v.props.showError&&r.status==="failed")return!0}),me=k(()=>{const t=g("labelWidth"),i=g("labelAlign");if(t&&i!=="top")return{width:Z(t)}}),he=t=>{t.keyCode===13&&(!(v&&v.props.submitOnEnter)&&e.type!=="textarea"&&O(t),e.type==="search"&&M()),n("keypress",t)},J=()=>e.id||"".concat(c,"-input"),be=()=>r.status,ve=()=>{const t=S("control",[g("inputAlign"),{error:G.value,custom:!!o.input,"min-height":e.type==="textarea"&&!e.autosize}]);if(o.input)return h("div",{class:t,onClick:Y},[o.input()]);const i={id:J(),ref:d,name:e.name,rows:e.rows!==void 0?+e.rows:void 0,class:t,disabled:g("disabled"),readonly:g("readonly"),autofocus:e.autofocus,placeholder:e.placeholder,autocomplete:e.autocomplete,autocapitalize:e.autocapitalize,autocorrect:e.autocorrect,enterkeyhint:e.enterkeyhint,spellcheck:e.spellcheck,"aria-labelledby":e.label?"".concat(c,"-label"):void 0,"data-allow-mismatch":"attribute",onBlur:ue,onFocus:ce,onInput:j,onClick:Y,onChange:ne,onKeypress:he,onCompositionend:ne,onCompositionstart:ot};return e.type==="textarea"?h("textarea",ee(i,{inputmode:e.inputmode}),null):h("input",ee(ct(e.type,e.inputmode),i),null)},ye=()=>{const t=o["left-icon"];if(e.leftIcon||t)return h("div",{class:S("left-icon"),onClick:de},[t?t():h(H,{name:e.leftIcon,classPrefix:e.iconPrefix},null)])},Se=()=>{const t=o["right-icon"];if(e.rightIcon||t)return h("div",{class:S("right-icon"),onClick:fe},[t?t():h(H,{name:e.rightIcon,classPrefix:e.iconPrefix},null)])},Ie=()=>{if(e.showWordLimit&&e.maxlength){const t=_(E());return h("div",{class:S("word-limit")},[h("span",{class:S("word-num")},[t]),qe("/"),e.maxlength])}},Ve=()=>{if(v&&v.props.showErrorMessage===!1)return;const t=e.errorMessage||r.validateMessage;if(t){const i=o["error-message"],l=g("errorMessageAlign");return h("div",{class:S("error-message",l)},[i?i({message:t}):t])}},Ee=()=>{const t=g("labelWidth"),i=g("labelAlign"),l=g("colon")?":":"";if(o.label)return[o.label(),l];if(e.label)return h("label",{id:"".concat(c,"-label"),for:o.input?void 0:J(),"data-allow-mismatch":"attribute",onClick:u=>{O(u),A()},style:i==="top"&&t?{width:Z(t)}:void 0},[e.label+l])},_e=()=>[h("div",{class:S("body")},[ve(),D.value&&h(H,{ref:L,name:e.clearIcon,class:S("clear")},null),Se(),o.button&&h("div",{class:S("button")},[o.button()])]),Ie(),Ve()];return le({blur:M,focus:A,validate:s,formValue:T,resetValidation:C,getValidationStatus:be}),je(Ke,{customValue:P,resetValidation:C,validateWithTrigger:f}),Re(()=>e.modelValue,()=>{b(E()),C(),f("onChange"),z(N)}),Fe(()=>{b(E(),e.formatTrigger),z(N)}),Ne("touchstart",ge,{target:k(()=>{var t;return(t=L.value)==null?void 0:t.$el})}),()=>{const t=g("disabled"),i=g("labelAlign"),l=ye(),u=()=>{const m=Ee();return i==="top"?[l,m].filter(Boolean):m||[]};return h(Qe,{size:e.size,class:S({error:G.value,disabled:t,["label-".concat(i)]:i}),center:e.center,border:e.border,isLink:e.isLink,clickable:e.clickable,titleStyle:me.value,valueClass:S("value"),titleClass:[S("label",[i,{required:R.value}]),e.labelClass],arrowDirection:e.arrowDirection},{icon:l&&i!=="top"?()=>l:null,title:u,value:_e,extra:o.extra})}}});const It=oe(gt),mt={};function ht(e,n){const o=Ze;return Ye(),Ue(o,{size:"small",plain:"",type:"primary"},{default:Ge(()=>[Je(e.$slots,"default",{},void 0,!0)]),_:3})}const Vt=He(mt,[["render",ht],["__scopeId","data-v-eaa60a3d"]]);export{It as F,Vt as _,St as a};
